buf needs to point to a valid memory locatio